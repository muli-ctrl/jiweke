<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jiweke Checkout</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #c8102e;
      margin-bottom: 20px;
    }
    .checkout-container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }

    /* --- Flip Section --- */
    .flip-section { text-align: center; margin-bottom: 25px; }
    .flip-card {
      background: transparent;
      width: 240px; height: 150px;
      perspective: 1000px;
      display: inline-block;
      margin: 0 10px;
      cursor: pointer;
    }
    .flip-inner {
      position: relative;
      width: 100%; height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .flip-card:hover .flip-inner { transform: rotateY(180deg); }
    .flip-front, .flip-back {
      position: absolute;
      width: 100%; height: 100%;
      border-radius: 12px;
      display: flex;
      align-items: center; justify-content: center;
      font-weight: 600; font-size: 1.5rem;
      color: #fff;
      backface-visibility: hidden;
    }
    .flip-front { background: #cc0c0c; }
    .flip-back { background: #000000; transform: rotateY(180deg); }

    /* Forms */
    form { display: none; flex-direction: column; gap: 12px; margin-top: 20px; }
    form.active { display: flex; }
    input, select, textarea {
      padding: 12px; border: 1px solid #ddd;
      border-radius: 8px; font-size: 1rem;
    }

    /* --- Payment Section --- */
    .payment-methods {
      display:flex; justify-content:center; gap:15px;
      flex-wrap:wrap; margin:20px 0;
    }
    .payment-method {
      padding:12px 20px; border-radius:10px;
      cursor:pointer; border:2px solid #ccc;
      display:flex; align-items:center; gap:10px;
      font-weight:600; transition:all 0.3s;
      min-width:150px; justify-content:center;
      color: #fff;
    }
    .payment-method i { font-size:1.2rem; }
    .payment-method:hover { transform:translateY(-2px); }
    .payment-method.selected { box-shadow:0 4px 10px rgba(0,0,0,0.15); }
    #mpesaBtn, #mpesaBtn2 { background:#34b233; border-color:#34b233; }
    #codBtn, #codBtn2 { background:#444; border-color:#444; }
    #paypalBtn, #paypalBtn2 { background:#0070ba; border-color:#0070ba; }

    /* --- Cart Summary --- */
    .cart-summary {
      margin: 20px auto; padding: 20px;
      border:1px solid #eee; border-radius:12px;
      background:#fafafa;
    }
    .cart-summary h2 { margin-bottom:10px; }
    .cart-item {
      display:flex; justify-content:space-between;
      padding:6px 0; border-bottom:1px solid #eee;
    }
    .cart-item:last-child { border-bottom:none; }
    .total { text-align:right; font-weight:bold; margin-top:10px; }

    /* --- Navigation Grid --- */
    .footer-grid {
      display:grid; grid-template-columns:1fr 1fr;
      gap:15px; margin:20px 0;
    }
    .footer-grid button {
      padding:12px; font-size:1rem; font-weight:600;
      border:none; border-radius:8px; cursor:pointer;
      background:#000; color:#fff; transition:0.3s;
    }
    .footer-grid button:hover { background:#c8102e; }

    /* --- Order Button --- */
    .order-btn {
      display:block; width:100%; margin-top:20px;
      padding:15px; font-size:1.2rem; font-weight:600;
      border:none; border-radius:10px;
      background:#1ba94c; color:#fff; cursor:pointer;
      transition:all 0.3s;
    }
    .order-btn:hover { background:#148a3b; }
  </style>
</head>
<body>
  <h1>Jiweke Checkout</h1>
  <div class="checkout-container">

    <!-- (1) Flip Section -->
    <div class="flip-section">
      <div class="flip-card" onclick="showForm('home')">
        <div class="flip-inner">
          <div class="flip-front">Home Delivery</div>
          <div class="flip-back">Deliver to your Door</div>
        </div>
      </div>
      <div class="flip-card" onclick="showForm('dine')">
        <div class="flip-inner">
          <div class="flip-front">Dine at Jiweke</div>
          <div class="flip-back">Reserve a Table</div>
        </div>
      </div>
    </div>

    <!-- (2) Payment + Forms -->
    <form id="homeForm" action="https://formspree.io/f/xgvzglzb" method="POST">
      <h2>üè† Home Delivery Details</h2>
      <input type="text" name="name" placeholder="Full Name" required>
      <input type="email" name="email" placeholder="Email Address" required>
      <textarea name="address" placeholder="Delivery Address" rows="3" required></textarea>
      <input type="tel" name="phone" placeholder="Phone Number" required>

      <h3>Select Payment</h3>
      <div class="payment-methods">
        <div class="payment-method" id="mpesaBtn"><i class="fa-solid fa-mobile-screen-button"></i> M-Pesa</div>
        <div class="payment-method" id="codBtn"><i class="fa-solid fa-money-bill"></i> Cash</div>
        <div class="payment-method" id="paypalBtn"><i class="fa-brands fa-paypal"></i> PayPal</div>
      </div>
      <div id="paypal-button-container" style="display:none;"></div>
    </form>

    <form id="dineForm" action="https://formspree.io/f/xgvzglzb" method="POST">
      <h2>üçΩÔ∏è Dine at Jiweke</h2>
      <input type="text" name="name" placeholder="Full Name" required>
      <input type="email" name="email" placeholder="Email Address" required>
      <input type="tel" name="phone" placeholder="Phone Number" required>
      <select name="zone" required>
        <option value="">Select Dining Zone</option>
        <option>Dj zone</option>
        <option>Pool zone</option>
        <option>Garden Area</option>
        <option>Hall Area</option>
      </select>

      <h3>Select Payment</h3>
      <div class="payment-methods">
        <div class="payment-method" id="mpesaBtn2"><i class="fa-solid fa-mobile-screen-button"></i> M-Pesa</div>
        <div class="payment-method" id="codBtn2"><i class="fa-solid fa-money-bill"></i> Cash</div>
        <div class="payment-method" id="paypalBtn2"><i class="fa-brands fa-paypal"></i> PayPal</div>
      </div>
      <div id="paypal-button-container-2" style="display:none;"></div>
    </form>

    <!-- (3) Cart Summary -->
    <div class="cart-summary" id="cartSummary">
      <h2>üõí Your Cart</h2>
      <div id="cartItems"></div>
      <div class="total" id="grandTotal">Total: KES 0.00</div>
      <div class="total" id="totalQty">Total Quantity: 0</div>
    </div>

    <!-- (4) Back Navigation -->
    <div class="footer-grid">
      <button onclick="window.location.href='cart.html'">‚Üê Back to Cart</button>
      <button onclick="window.location.href='index.html'">Continue Shopping ‚Üí</button>
    </div>

    <!-- (5 & 6) Place Order -->
    <button class="order-btn" id="placeOrderBtn">Place Order</button>
  </div>

<script>
  let selectedPayment = "";

  function showForm(type) {
    document.getElementById("homeForm").classList.remove("active");
    document.getElementById("dineForm").classList.remove("active");
    if(type==="home") document.getElementById("homeForm").classList.add("active");
    else document.getElementById("dineForm").classList.add("active");
  }

  function setupPayments(mpesa,cod,paypal,container){
    document.getElementById(mpesa).addEventListener('click',()=>{
      selectedPayment="mpesa"; highlight(mpesa,cod,paypal,container);
      alert("‚úÖ Simulated M-Pesa STK Push");
    });
    document.getElementById(cod).addEventListener('click',()=>{
      selectedPayment="cod"; highlight(mpesa,cod,paypal,container);
    });
    document.getElementById(paypal).addEventListener('click',()=>{
      selectedPayment="paypal"; highlight(mpesa,cod,paypal,container);
      document.getElementById(container).style.display="block";
    });
  }

  function highlight(mpesa,cod,paypal,container){
    [mpesa,cod,paypal].forEach(id=>document.getElementById(id).classList.remove("selected"));
    document.getElementById(container).style.display="none";
    if(selectedPayment==="paypal") document.getElementById(container).style.display="block";
    if(selectedPayment==="mpesa") document.getElementById(mpesa).classList.add("selected");
    if(selectedPayment==="cod") document.getElementById(cod).classList.add("selected");
    if(selectedPayment==="paypal") document.getElementById(paypal).classList.add("selected");
  }

  setupPayments("mpesaBtn","codBtn","paypalBtn","paypal-button-container");
  setupPayments("mpesaBtn2","codBtn2","paypalBtn2","paypal-button-container-2");

  // PayPal Sandbox Buttons
  paypal.Buttons({
    createOrder:(data,actions)=> actions.order.create({ purchase_units:[{ amount:{ value:"10.00" } }] }),
    onApprove:(data,actions)=> actions.order.capture().then(details=>{
      alert("‚úÖ PayPal payment by " + details.payer.name.given_name);
    })
  }).render('#paypal-button-container');

  paypal.Buttons({
    createOrder:(data,actions)=> actions.order.create({ purchase_units:[{ amount:{ value:"10.00" } }] }),
    onApprove:(data,actions)=> actions.order.capture().then(details=>{
      alert("‚úÖ PayPal payment by " + details.payer.name.given_name);
    })
  }).render('#paypal-button-container-2');

  // Cart Rendering
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const cartItems = document.getElementById('cartItems');
  const grandTotal = document.getElementById('grandTotal');
  const totalQty = document.getElementById('totalQty');
  function renderCart(){
    cartItems.innerHTML=''; let total=0; let qtyTotal=0;
    if(cart.length===0){ cartItems.innerHTML='<p>Your cart is empty.</p>'; return;}
    cart.forEach(item=>{
      const qty=item.quantity||1;
      const subtotal=item.price*qty;
      total+=subtotal; qtyTotal+=qty;
      const div=document.createElement('div');
      div.className='cart-item';
      div.innerHTML=`${item.name} x${qty} - KES ${subtotal.toFixed(2)}`;
      cartItems.appendChild(div);
    });
    grandTotal.textContent=`Total: KES ${total.toFixed(2)}`;
    totalQty.textContent=`Total Quantity: ${qtyTotal}`;
  }
  renderCart();

  // Place Order
  document.getElementById('placeOrderBtn').addEventListener('click',()=>{
    if(cart.length===0){alert("Cart is empty!");return;}
    if(!selectedPayment){alert("Select payment first!");return;}
    alert("‚úÖ Order placed successfully. Confirmation email will be sent.");
    localStorage.removeItem('cart');
    window.location.href="index.html";
  });
</script>
</body>
</html>

